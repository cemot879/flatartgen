<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FlatArtGen ‚Äì Generator Gambar 2D</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; background: #f3f4f6; }
    input { width: 320px; padding: 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 12px 24px; background-color: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; }
    button:hover { background-color: #2563eb; }
    img { margin-top: 24px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>üé® FlatArtGen ‚Äì Generator Gambar 2D</h1>
  <input id="prompt" type="text" placeholder="Deskripsi gambar, contoh: kota minimalis warna pastel" />
  <br /><br />
  <button onclick="startGeneration()">Generate Gambar</button>
  <div id="result" style="margin-top: 30px;"></div>

  <script>
    let pollInterval;

    async function startGeneration() {
      const prompt = document.getElementById("prompt").value.trim();
      const resultDiv = document.getElementById("result");
      if (!prompt) {
        alert("Masukkan prompt dulu ya!");
        return;
      }
      resultDiv.innerHTML = "‚è≥ Memproses gambar...";

      try {
        const response = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt }),
        });
        const data = await response.json();
        if (data.jobId) {
          pollStatus(data.jobId);
        } else {
          resultDiv.innerHTML = "‚ùå Gagal memulai generate.";
        }
      } catch (err) {
        resultDiv.innerHTML = "‚ùå Error: " + err.message;
      }
    }

    function pollStatus(jobId) {
      const resultDiv = document.getElementById("result");
      let tries = 0;
      pollInterval = setInterval(async () => {
        tries++;
        if (tries > 30) { // timeout 60 detik
          clearInterval(pollInterval);
          resultDiv.innerHTML = "‚õî Timeout generate gambar.";
          return;
        }
        try {
          const res = await fetch(`/api/status?jobId=${jobId}`);
          const json = await res.json();
          if (json.done && json.generations && json.generations.length > 0) {
            clearInterval(pollInterval);
            const base64 = json.generations[0].img;
            resultDiv.innerHTML = `<img src="data:image/png;base64,${base64}" width="300" />`;
          } else {
            resultDiv.innerHTML = `‚è≥ Memproses... (${tries * 2}s)`;
          }
        } catch (err) {
          clearInterval(pollInterval);
          resultDiv.innerHTML = "‚ùå Error saat cek status: " + err.message;
        }
      }, 2000);
    }
  </script>
</body>
</html>
